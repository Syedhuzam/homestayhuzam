<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <% console.log(phone) %>
    <div id="order-amt">400</div>
    <br>
    <!-- Get order id from razorpay -->
    <button id="order-button1">Create Order</button>
    <br>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <script>
       const Axios = axios.create();        
        document.getElementById("order-button1").onclick = function(e) {
            var url = "/payments/order";
            var params = {
                amount: document.getElementById("order-amt").innerText,
                currency: "INR",
                receipt: "wthcoding001",
                payment_capture: '1'
            };
            var xmlHttp = new XMLHttpRequest();
            // xmlHttp.onreadystatechange = function(res) {
            //     if (xmlHttp.readyState === 4) {
            //         res = JSON.parse(xmlHttp.responseText);
            //        console.log(res.sub.id)
            //     }
            // }
            xmlHttp.open("POST", url, false);
            xmlHttp.setRequestHeader("Content-type", "application/json");
            xmlHttp.send(JSON.stringify(params));
            res = JSON.parse(xmlHttp.responseText);
            var order_id = res.sub.id 
            console.log(order_id)
         
            var options = {
            "key":"rzp_test_bN8pZAzSf06b6x" ,
            "currency": "INR",
            "name": "The Rose Home Stay",
            "description": "The Rose Home Stay Transaction",
            "order_id": order_id,
            "handler": function(r) {
                const postData = {
                    p_id : r.razorpay_payment_id,
                    o_id : r.razorpay_order_id,
                    sign : r.razorpay_signature,
                    phone :  '<%- JSON.stringify(phone)%>'
                }
                Axios.post('/payments/order/post',postData).then(
                    r =>{
                        console.log(r.data+"has been saved")
                    }
                )
                .catch(e =>{console.log(e)})
            }
        };         
        var rzp1 = new Razorpay(options);
        rzp1.open();
        e.preventDefault();
        }
    </script>
</body>
</html>